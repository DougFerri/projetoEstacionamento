<!DOCTYPE html>
<html  lang="en">
<head>
<meta charset="utf-8">
<title>Controle de Estacionamento</title>
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

<style type="text/css">

html{
	margin-left: 20%;
	margin-right: 20%;
	margin-bottom: 10%;
	margin-top: 2%
}

label{
	color: blue;
	font-size: 20px;
	margin-left: 1%;
}

.label{

}

input{
	size: 100px;
	
	
}

.bordas{
	

	box-shadow: 0px 0px 1em #666;
	-webkit-box-shadow: 0px 0px 1em #666;
	-moz-box-shadow: 0px 0px 1em #666;

}
</style>

</head>
<body>

<div >
	<img  src="C:/projetos/Java/parking-control/parking-control/src/main/resources/templates/imagens/logo.png">
	
</div>

<form action="" id="formCadastro" style="margin-left: 3%; margin-right: 3%;" class="bordas">

<div style="margin-left: 3%; margin-right: 3%; margin-bottom: 5%; margin-top: 2%;">
<div style="margin-right: 1%; margin-top: 5%;">
  <label for="id" style="width: 300px; ;margin-top: 2%">Id de controle</label>
  <input id="id" readonly="readonly" disabled="disabled">
</div>
 
<div class="mb-3">
  <label for="parkingSpotNumber" style="width: 300px; margin-left: 1%; margin-top: 2%">Número da vaga</label>
  <input type="text"  id="parkingSpotNumber" placeholder="Digite o número da vaga" required="required">
</div>

<div class="mb-3">
  <label for="licencePlateCar" style="width: 300px; margin-left: 1%; margin-top: 2%">Número da placa do veículo</label>
  <input type="text" id="licencePlateCar" placeholder="Digite o número da placa" required="required">
</div>

<div class="mb-3">
  <label for="brandCar" style="width: 300px; margin-left: 1%; margin-top: 2%;">Marca do veículo</label>
  <input type="text" id="brandCar" placeholder="Digite a marca do veículo" required="required">
</div>

<div class="mb-3">
  <label for="modelCar" style="width: 300px; margin-left: 1%; margin-top: 2%;">Modelo do veícuo</label>
  <input type="text"  id="modelCar" placeholder="Digite o modelo do veículo" required="required">
</div>

<div class="mb-3">
  <label for="colorCar" style="width: 300px; margin-left: 1%; margin-top: 2%;">Cor do veículo</label>
  <input type="text"  id="colorCar" placeholder="Digite a cor do veículo" required="required">
</div>

<div class="mb-3">
  <label for="responsibleName" style="width: 300px; margin-left: 1%; margin-top: 2%;">Nome do responsável</label>
  <input type="text"  id="responsibleName" placeholder="Digite o nome do responsável" required="required">
</div>

<div class="mb-3">
  <label for="apartment" style="width: 300px; margin-left: 1%; margin-top: 2%">Número do apartamento</label>
  <input type="text"  id="apartment" placeholder="Digite o número do apartemento" required="required">
</div>

<div class="mb-3">
  <label for="block" style="width: 300px; margin-left: 1%; margin-top: 2%">Bloco/Complemento</label>
  <input type="text"  id="block" placeholder="Digite o bloco/complemento" required="required">
</div>

<div style="margin-left: 2%;">
	<button type="button" class="btn btn-primary" onclick="salvarUsuario()">Salvar</button>
	<button type="button" class="btn btn-primary" onclick="document.getElementById('formCadastro').reset();">Limpar</button>
	<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalPesquisar" >Pesquisar</button>
	<button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#modalDeletar" onclick="buscaTodos()">Deletar</button>
</div>
<br>
</div>


</form>





<div class="modal fade" id="modalPesquisar" tabindex="-1" aria-labelledby="modalPesquisar" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Pesquisa Vaga</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form action="" id="formTab">
      <div class="modal-body">
        
          <div class="mb-3">
            <label for="idPesquisa" class="col-form-label">Insira o Id da vaga aqui</label>
            <input type="id" class="form-control" id="idPesquisa">
          </div>

      </div>
	</form>	
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Sair</button>
        <button type="button" class="btn btn-primary" onclick="buscarVaga(), document.getElementById('formTab').reset()" data-bs-dismiss="modal">Buscar</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modalDeletar" tabindex="-1" aria-labelledby="modalDeletar" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Deletar Vaga</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
 	      <div style="height: 400px; overflow: scroll;">
		    <table class="table" id="tabelaDelete">
		     <thead>
		      <tr>
		       <th scope="col">Vaga</th>
		       <th scope="col">Placa</th>
		       <th scope="col">Responsável</th>
		       <th scope="col"></th>
		      </tr>
		    </thead>
	        <tbody>
		    </tbody>
		   </table>
		  </div>

    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Sair</button>
      </div>
    </div>
  </div>
</div>

<!-- Option 1: Bootstrap Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    
    
<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous">
</script>

<script type="text/javascript">

	function salvarUsuario(){
		var id=$("#id").val();
		var parkingSpotNumber= $("#parkingSpotNumber").val();
		var licencePlateCar= $("#licencePlateCar").val();
		var brandCar= $("#brandCar").val();
		var modelCar= $("#modelCar").val();
		var colorCar= $("#colorCar").val();
		var responsibleName= $("#responsibleName").val();
		var apartment= $("#apartment").val();
		var block= $("#block").val();
		var ok= "S";
		
		if (!id){
			$("#id").val("");
		}
		if(!parkingSpotNumber){
			alert("Número da vaga não informada");
			ok="N";
		}
		if(!licencePlateCar){
			alert("Placa do veículo não informada");
			ok="N";
		}
		if(!brandCar){
			alert("Marca do veículo não informada");
		}
		if(!modelCar){
			alert("Modelo do veículo não informado");
			ok="N";
		}
		if(!colorCar){
			alert("Cor do veículo não informado");
			ok="N";
		}
		if(!responsibleName){
			alert("Nome do responsável não informado");
			ok="N";
		}
		if(!apartment){
			alert("Apartamento não informado");
			ok="N";
		}
		if(!block){
			alert("Bloco/Complemento não informado");
			ok="N";
		}

		if(ok === "S"){
			$.ajax({
				method: 'POST',
				url: '/parking-control/parking-spot/save',
				data: JSON.stringify({id : id, parkingSpotNumber : parkingSpotNumber, licencePlateCar : licencePlateCar, brandCar : brandCar, modelCar : modelCar, colorCar : colorCar, responsibleName : responsibleName, apartment : apartment, block : block}),
				dataType : 'json',
				contentType: 'application/json',
				success : function(response){
					$("#id").val(response.id);
					alert("Salvo com sucesso");
				}
			}).done(function() {
				console.log("success");
			}).fail(function (xhr, status, errorThrown){
				alert("Erro ao salvar: " + xhr.responseText);
			});
		}
	}

	function buscarVaga(){

		var id= $("#idPesquisa").val();
		var ok= "S";
		var parm= JSON.stringify({id: id});

		if(!id){
			alert("Id da vaga não informado");
			ok="N";
		}
		

		if(ok === "S"){
			$.ajax({
				method: 'GET',
				url: '/parking-control/parking-spot/getOne',
				dataType: 'json',
				data: {rfc: $("#idPesquisa").val()},			
				contentType: 'application/json',
				success : function(response){
					$('#tabelaResultados > tbody  > tr').remove();
					
	//				for (var i = 0; i < response.length; i++){
						$('#tabelaResultados > tbody').append('<tr><td>'+response.parkingSpotNumber+'</td><td>'+response.brandCar+'</td><td>'+response.modelCar+'</td><td>'+response.licencePlateCar+'</td><td>'+response.responsibleName+'</td><td><button type="button" class="btn btn-primary" onclick="editar('+response.responsibleName+')">Editar</button></td></tr>');
		//			}
						$("#id").val(response.id);
						$("#parkingSpotNumber").val(response.parkingSpotNumber);
						$("#licencePlateCar").val(response.licencePlateCar);
						$("#brandCar").val(response.brandCar);
						$("#modelCar").val(response.modelCar);
						$("#colorCar").val(response.colorCar);
						$("#responsibleName").val(response.responsibleName);
						$("#apartment").val(response.apartment);
						$("#block").val(response.block);

				}
			}).done(function() {
				console.log("success");
			}).fail(function (xhr, status, errorThrown){
				alert("Erro buscar: " + xhr.responseText);
				document.getElementById('formCadastro').reset();
			});
		}
	}
		
		function buscaTodos(){
 
			$.ajax({
				method: 'GET',
				url: '/parking-control/parking-spot/get',
				dataType: 'json',		
				contentType: 'application/json',
				success : function(response){
					$('#tabelaDelete > tbody  > tr').remove();
					 
				for (var i = 0; i < response.length; i++){
					$('#tabelaDelete > tbody').append('<tr id="'+response[i].id+'"><td>'+response[i].parkingSpotNumber+'</td><td>'+response[i].licencePlateCar+'</td><td>'+response[i].responsibleName+'</td><td><button type="button" class="btn btn-danger" onclick="deletar('+response[i].id+')">Deletar</button></td></tr>');
					}
				}
				}).done(function() {
					console.log("success");
				}).fail(function (xhr, status, errorThrown){
					alert("Erro ao buscar todos: " + xhr.responseText);
				});		
			
		}

		function deletar(id){
	
			$.ajax({
				method: 'DELETE',
				url: '/parking-control/parking-spot/del',	
				data: "id=" + id,			
				success : function(response){
					
					$('#' + id).remove();

					alert("Dados apagados com sucesso!");
			 
				}
				}).done(function() {
					console.log("success deletar");
				}).fail(function (xhr, status, errorThrown){
					alert("Erro ao deletar: " + xhr.responseText);
				});		
			
		}

</script>
</body>
</html>